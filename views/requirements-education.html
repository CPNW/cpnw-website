<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CPNW â€” Education Requirements</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <header class="cpnw-header">
    <nav class="navbar navbar-expand-md py-2" aria-label="Primary">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="../index.html" aria-label="CPNW Home">
          <img class="cpnw-logo" src="../images/CPNWLogoo.png" alt="Clinical Placements Northwest" />
        </a>
        <div class="d-flex align-items-center gap-2 ms-auto">
          <button data-theme-toggle type="button" class="btn btn-outline-secondary btn-sm btn-cpnw" aria-label="Toggle dark and light mode">
            <span class="me-1" aria-hidden="true" data-theme-icon>ðŸŒ™</span>
            <span class="fw-bold" data-theme-label>Dark</span>
          </button>
          <a class="btn btn-sm btn-cpnw btn-cpnw-primary" href="#">Log out</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="py-4 py-lg-5">
    <div class="container position-relative">
      <img src="../images/spores-watermark.png" class="cpnw-spores" alt="" aria-hidden="true" />

      <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
        <a class="btn btn-outline-secondary btn-sm btn-cpnw" href="dashboard-education.html">Back to dashboard</a>
        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-cpnw btn-cpnw-primary btn-sm" href="requirements-education.html" aria-current="page">Requirements</a>
          <div class="dropdown">
            <button class="btn btn-cpnw btn-cpnw-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              My Account
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="my-profile.html">My Profile</a></li>
              <li><a class="dropdown-item" href="security-settings.html">Security Settings</a></li>
            </ul>
          </div>
          <div class="dropdown">
            <button class="btn btn-cpnw btn-cpnw-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              Admin
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="review-education.html">Review</a></li>
              <li><a class="dropdown-item" href="assignments-education.html">Assignments</a></li>
              <li><a class="dropdown-item" href="reports-education.html">Education Reports</a></li>
              <li><a class="dropdown-item" href="users.html">Users</a></li>
              <li><a class="dropdown-item" href="background-watch-reports.html">Background + WATCH Reports</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="d-flex flex-wrap justify-content-between align-items-start mb-4 gap-3">
        <div>
          <p class="text-uppercase fw-bold cpnw-ls-08 cpnw-fs-75 mb-1">Requirements</p>
          <h1 class="h3 fw-semibold mb-1">Education Requirements</h1>
          <p class="text-body-secondary mb-0">Manage the requirements that programs assign to users.</p>
        </div>
        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-cpnw btn-cpnw-primary" href="requirement-builder.html">
            Create Requirement
          </a>
        </div>
      </div>

      <div class="cpnw-shell p-0 overflow-hidden">
        <div class="d-flex flex-wrap justify-content-between align-items-center p-3 gap-3 border-bottom">
          <div class="d-flex align-items-center gap-2">
            <label class="small text-body-secondary mb-0" for="reqPageSize">Show</label>
            <select class="form-select form-select-sm" id="reqPageSize" style="width: auto;">
              <option value="10" selected>10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
            <span class="small text-body-secondary">entries</span>
          </div>
          <div class="d-flex align-items-center gap-2">
            <label class="small text-body-secondary mb-0" for="reqSearch">Search:</label>
            <input class="form-control form-control-sm" id="reqSearch" style="width: min(340px, 70vw);" placeholder="Searchâ€¦" />
          </div>
        </div>

        <div class="table-responsive">
          <table class="table align-middle mb-0 cpnw-table">
            <thead class="text-body-secondary small">
              <tr>
                <th scope="col"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="name">Name</button></th>
                <th scope="col" class="d-none d-md-table-cell"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="category">Type</button></th>
                <th scope="col" class="d-none d-lg-table-cell"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="frequency">Frequency</button></th>
                <th scope="col" class="d-none d-xl-table-cell"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="requiredBy">Required By</button></th>
                <th scope="col" class="d-none d-xl-table-cell"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="userType">Required For</button></th>
                <th scope="col" class="text-nowrap"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="createdAt">Created</button></th>
                <th scope="col" class="text-nowrap d-none d-lg-table-cell"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="retiredAt">Retired</button></th>
                <th scope="col" class="text-nowrap"><button class="btn btn-link p-0 text-decoration-none sort" data-sort="status">Status</button></th>
                <th scope="col" class="text-end">Edit</th>
                <th scope="col" class="text-end">Delete</th>
              </tr>
            </thead>
            <tbody id="reqTableBody"></tbody>
          </table>
        </div>

        <div class="d-flex flex-wrap justify-content-between align-items-center p-3 gap-2 border-top">
          <div class="small text-body-secondary" id="reqPageInfo">Page 1</div>
          <div class="d-flex align-items-center gap-2">
            <button class="btn btn-outline-secondary btn-sm btn-cpnw" type="button" id="reqPrev">Prev</button>
            <button class="btn btn-outline-secondary btn-sm btn-cpnw" type="button" id="reqNext">Next</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="cpnw-footer py-3 py-lg-4">
    <div class="container">
      <div class="cpnw-footer-inner text-center">
        <div class="small text-body-secondary">
          Copyright Â© 2024 Clinical Placements Northwest | All rights reserved.
          <a class="text-decoration-none" href="../terms-privacy.html">Terms of Use and Privacy Policy</a>
        </div>
        <div class="mt-2">
          <button type="button" class="btn btn-cpnw btn-cpnw-primary btn-sm" data-contact-trigger>
            Contact Us
          </button>
        </div>
      </div>
    </div>
  </footer>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script src="../js/main.js?v=20251214-2"></script>
  <script>
    (function(){
      const KEY = 'cpnw-education-requirements-v1';
      const tableBody = document.getElementById('reqTableBody');
      const search = document.getElementById('reqSearch');
      const pageSizeSelect = document.getElementById('reqPageSize');
      const pageInfo = document.getElementById('reqPageInfo');
      const prevBtn = document.getElementById('reqPrev');
      const nextBtn = document.getElementById('reqNext');

      let sortState = { field: 'createdAt', dir: 'desc' };
      let page = 1;
      let pageSize = Number(pageSizeSelect?.value || 10);

      function loadJSON(key, fallback){
        try{
          const raw = localStorage.getItem(key);
          if (!raw) return fallback;
          return JSON.parse(raw) ?? fallback;
        }catch{
          return fallback;
        }
      }

      function saveJSON(key, value){
        try{
          localStorage.setItem(key, JSON.stringify(value));
        }catch{
          // ignore
        }
      }

      function seedIfEmpty(){
        const current = loadJSON(KEY, null);
        if (Array.isArray(current) && current.length) return;
        const now = new Date();
        const iso = (d) => d.toISOString().slice(0, 10);
        const withOffset = (days) => {
          const d = new Date(now);
          d.setDate(d.getDate() - days);
          return iso(d);
        };
        const seeded = [
          {
            id: 'req_parking_map',
            name: 'Parking map',
            abbr: 'PARK',
            requiredBy: 'Education',
            category: 'Site Orientation',
            frequency: 'Once',
            userType: 'Student',
            status: 'Active',
            createdAt: withOffset(180),
            retiredAt: '',
            instructionsHTML: '<p>Review the parking map before your first day at the site.</p>',
            linkedFiles: [{ name: 'ParkingMap.pdf', url: '#' }]
          },
          {
            id: 'req_liability',
            name: 'Liability Insurance',
            abbr: 'LIAB',
            requiredBy: 'Education',
            category: 'Insurance',
            frequency: 'Annually',
            userType: 'Student',
            status: 'Active',
            createdAt: withOffset(120),
            retiredAt: '',
            instructionsHTML: '<p>Upload proof of current liability insurance.</p>',
            linkedFiles: []
          },
          {
            id: 'req_driver_license',
            name: "Driver's License - Color Copy",
            abbr: 'DL',
            requiredBy: 'Education',
            category: 'Forms',
            frequency: 'Once',
            userType: 'Student',
            status: 'Active',
            createdAt: withOffset(90),
            retiredAt: '',
            instructionsHTML: '<p>Upload a color copy of your current driverâ€™s license.</p>',
            linkedFiles: []
          }
        ];
        saveJSON(KEY, seeded);
      }

      function prettyDate(val){
        if (!val) return '<span class="text-body-secondary">â€”</span>';
        const date = new Date(val);
        if (Number.isNaN(date.getTime())) return '<span class="text-body-secondary">â€”</span>';
        return date.toLocaleDateString(undefined, { year:'numeric', month:'2-digit', day:'2-digit' });
      }

      function statusBadge(status){
        const norm = String(status || '').toLowerCase();
        if (norm === 'active') return '<span class="badge text-bg-success">Active</span>';
        if (norm === 'inactive') return '<span class="badge text-bg-secondary">Inactive</span>';
        if (norm === 'retired') return '<span class="badge text-bg-secondary">Retired</span>';
        return `<span class="badge text-bg-secondary">${status || 'â€”'}</span>`;
      }

      function getAll(){
        const list = loadJSON(KEY, []);
        return Array.isArray(list) ? list : [];
      }

      function saveAll(list){
        saveJSON(KEY, list);
      }

      function removeById(id){
        const list = getAll().filter(r => r.id !== id);
        saveAll(list);
      }

      function normalizeSortVal(field, item){
        if (field === 'createdAt' || field === 'retiredAt'){
          return item[field] ? new Date(item[field]).getTime() : 0;
        }
        return String(item[field] ?? '').toLowerCase();
      }

      function render(){
        if (!tableBody) return;
        const q = (search?.value || '').toLowerCase().trim();
        const rows = getAll().filter(r => {
          if (!q) return true;
          const hay = `${r.name} ${r.abbr} ${r.category} ${r.frequency} ${r.requiredBy} ${r.userType} ${r.status}`.toLowerCase();
          return hay.includes(q);
        });

        rows.sort((a,b) => {
          const field = sortState.field || 'createdAt';
          const dir = sortState.dir === 'desc' ? -1 : 1;
          const va = normalizeSortVal(field, a);
          const vb = normalizeSortVal(field, b);
          if (va < vb) return -1 * dir;
          if (va > vb) return 1 * dir;
          return String(a.name || '').localeCompare(String(b.name || ''));
        });

        const total = rows.length;
        const totalPages = Math.max(1, Math.ceil(total / pageSize));
        if (page > totalPages) page = totalPages;
        const start = (page - 1) * pageSize;
        const end = Math.min(start + pageSize, total);
        const items = rows.slice(start, end);

        tableBody.innerHTML = '';
        if (!items.length){
          const tr = document.createElement('tr');
          tr.innerHTML = `<td colspan="10" class="text-body-secondary small py-4">No requirements found.</td>`;
          tableBody.appendChild(tr);
        }else{
          items.forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>
                <div class="fw-semibold">${r.name || 'â€”'}</div>
                <div class="small text-body-secondary">${r.abbr ? `Abbr: ${r.abbr}` : ''}</div>
              </td>
              <td class="d-none d-md-table-cell">${r.category || 'â€”'}</td>
              <td class="d-none d-lg-table-cell">${r.frequency || 'â€”'}</td>
              <td class="d-none d-xl-table-cell">${r.requiredBy || 'â€”'}</td>
              <td class="d-none d-xl-table-cell">${r.userType || 'â€”'}</td>
              <td class="text-nowrap">${prettyDate(r.createdAt)}</td>
              <td class="text-nowrap d-none d-lg-table-cell">${prettyDate(r.retiredAt)}</td>
              <td class="text-nowrap">${statusBadge(r.status)}</td>
              <td class="text-end">
                <a class="btn btn-cpnw btn-cpnw-primary btn-sm" href="requirement-builder.html?id=${encodeURIComponent(r.id)}">Edit</a>
              </td>
              <td class="text-end">
                <button class="btn btn-danger btn-sm" type="button" data-delete-id="${r.id}">Delete</button>
              </td>
            `;
            tableBody.appendChild(tr);
          });
        }

        if (pageInfo){
          pageInfo.textContent = total ? `Showing ${start + 1}â€“${end} of ${total}` : 'No results';
        }
        if (prevBtn) prevBtn.disabled = page <= 1;
        if (nextBtn) nextBtn.disabled = end >= total;
      }

      document.querySelectorAll('.sort').forEach(btn => {
        btn.addEventListener('click', () => {
          const field = btn.dataset.sort;
          if (!field) return;
          if (sortState.field === field){
            sortState.dir = sortState.dir === 'asc' ? 'desc' : 'asc';
          }else{
            sortState.field = field;
            sortState.dir = 'asc';
          }
          render();
        });
      });

      tableBody?.addEventListener('click', (e) => {
        const del = e.target.closest('button[data-delete-id]');
        if (!del) return;
        const id = del.dataset.deleteId;
        if (!id) return;
        const item = getAll().find(r => r.id === id);
        const label = item?.name || 'this requirement';
        if (!window.confirm(`Delete "${label}"? This cannot be undone in this demo.`)) return;
        removeById(id);
        render();
      });

      search?.addEventListener('input', () => { page = 1; render(); });
      pageSizeSelect?.addEventListener('change', () => {
        pageSize = Number(pageSizeSelect.value || 10);
        page = 1;
        render();
      });
      prevBtn?.addEventListener('click', () => { page = Math.max(1, page - 1); render(); });
      nextBtn?.addEventListener('click', () => { page = page + 1; render(); });

      seedIfEmpty();
      render();
    })();
  </script>
</body>
</html>

